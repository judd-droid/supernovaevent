<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Quick Financial Wellnes Check</title>
<meta name="theme-color" content="#111827">
<style>
:root{
  --sn-red:#DD467D; --sn-black:#111827; --sn-gray:#6b7280;
  --bg:#f8fafc; --card:#ffffff; --line:#e5e7eb; --radius:18px;
  --sel-bg:#ffe8f1;
  --ok:#16a34a;               /* green-600 */
  --sel-green-bg:#e9f9ef;     /* light green fill */
}

/* Selected state for green variant */
.opt[data-variant="green"][data-selected="true"]{
  background:var(--sel-green-bg);
  border-color:var(--ok);
  box-shadow:0 0 0 3px rgba(22,163,74,.12);
  color:#064e3b; /* readable on light green */
}

*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--sn-black);background:linear-gradient(180deg,#fff,#f5f7fb)}
.hide{display:none !important}

.app{max-width:720px;margin:0 auto;padding:12px 16px 96px}
header{position:sticky;top:0;z-index:10;background:var(--card);border-bottom:1px solid var(--line);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:10px;font-weight:700}
.brand .dot{width:10px;height:10px;border-radius:999px;background:var(--sn-red);box-shadow:0 0 0 3px #ffd4e5 inset}
header .title{font-size:18px}
.btn-icon{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;cursor:pointer}

.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 8px 32px rgba(17,24,39,.05);padding:16px;margin:16px 0}
.card h3{margin:0 0 12px;font-size:15px;color:#0f172a}
.row{display:grid;gap:10px}
.grid-2{grid-template-columns:1fr 1fr}
.grid-3{grid-template-columns:1fr 1fr 1fr}
@media (max-width:720px){.grid-3{grid-template-columns:1fr 1fr}}
.mt8{margin-top:8px}
.mt12{margin-top:12px}
.mt16{margin-top:16px}

.input,select{width:100%;padding:14px 12px;border:1px solid var(--line);border-radius:12px;background:#fff;font-size:16px}
textarea.input{min-height:110px;resize:vertical}
.label{font-size:13px;color:var(--sn-gray);margin-bottom:6px}

.opt{display:flex;align-items:center;justify-content:center;text-align:center;padding:14px 10px;background:#fff;border:1.5px solid var(--line);border-radius:14px;cursor:pointer;user-select:none;font-weight:600;min-height:56px;line-height:1.2}
.opt.small{font-weight:500;min-height:48px}
.opt[data-selected="true"]{border-color:var(--sn-red);box-shadow:0 0 0 3px rgba(221,70,125,.12);background:var(--sel-bg)}
.opt[data-variant="dark"][data-selected="true"]{background:#0f172a;color:#fff;border-color:#0f172a}
.badge{font-size:12px;padding:2px 6px;border-radius:999px;background:#eef2ff;color:#3730a3;margin-left:6px}

.actions{display:flex;gap:12px;align-items:center;justify-content:space-between}
.button{display:inline-flex;align-items:center;justify-content:center;padding:14px 18px;border-radius:14px;font-weight:700;cursor:pointer;border:0}
.button.primary{background:#0f172a;color:#fff}
.button.ghost{background:#fff;border:1px solid var(--line);color:#0f172a}
.button.warn{background:var(--sn-red);color:#fff}
.button.full{width:100%}
.small{font-size:12px;color:var(--sn-gray)}

.nav{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.95);border-top:1px solid var(--line);backdrop-filter:saturate(180%) blur(6px);padding:10px 12px;display:flex;gap:12px;justify-content:center}
.tab{flex:1;border:2px solid #ffd1e2;background:#ffe3ee;color:#111;border-radius:18px;padding:10px 12px;font-weight:700;text-align:center;cursor:pointer}
.tab[data-active="true"]{background:#fbd1e3}
.tab.disabled{opacity:.5;pointer-events:none}

#resultView .kv{display:grid;grid-template-columns:170px 1fr;gap:6px;margin:6px 0}
#resultView h2{margin:0 0 10px}
.hr{height:1px;background:var(--line);margin:10px 0}

@media print{
  header,.nav,.no-print,#resultView{display:none !important}
  .app{padding:0}
  .card{border:none;box-shadow:none;margin:0;padding:0}
  #resultToPrint{display:block !important}
  @page{size:A4;margin:14mm}
}
#resultToPrint{display:none}
</style>
</head>
<body>
<header>
  <div class="brand"><span class="dot"></span><div class="title">Quick Financial Wellness Check</div></div>
  <button id="btnSettingsOpen" class="btn-icon">Settings</button>
</header>

<main class="app">
  <!-- SETTINGS -->
  <section id="tab-settings">
    <div class="card">
      <h3>Settings</h3>
      <div class="row grid-2">
        <div><div class="label">Advisor name</div><input id="s-advisor" class="input" placeholder="Your name" /></div>
        <div><div class="label">Event Code</div><input id="s-event" class="input" placeholder="e.g., MDC-0910-AM" /></div>
        <div><div class="label">Advisor mobile</div><input id="s-advisorPhone" class="input" placeholder="09xxxxxxxxx" inputmode="tel" /></div>
      </div>
      <div class="actions mt16">
        <button id="btnSaveSettings" class="button primary">Save Settings</button>
      </div>
      <div class="small mt8" id="settingsWarn"></div> <!-- space above 'Saved.' -->
    </div>
  </section>

  <!-- NEW CHECKUP -->
  <section id="tab-new" class="hide">
    <div class="card">
      <h3>Respondent</h3>
      <div class="row grid-2">
        <div><div class="label">Name</div><input id="clientName" class="input" placeholder="e.g., Juan Dela Cruz" /></div>
        <div><div class="label">Mobile</div><input id="clientMobile" class="input" inputmode="tel" placeholder="09xxxxxxxxx" /></div>
      </div>
    </div>

    <div class="card">
      <h3>1) Who are you today?</h3>
      <div class="row grid-2" data-group="role">
        <div class="opt" data-value="Staff">Staff</div>
        <div class="opt" data-value="Patient/Visitor">Patient/Visitor</div>
      </div>
    </div>

    <div class="card">
      <h3>2) Are you the breadwinner?</h3>
      <div class="row grid-3" data-group="breadwinner">
        <div class="opt" data-value="Yes">Yes</div>
        <div class="opt" data-value="Shared">Shared</div>
        <div class="opt" data-value="No">No</div>
      </div>
    </div>

    <div class="card">
      <h3>3) Priority <span class="badge">pick one</span></h3>
      <div class="row grid-2" data-group="priority">
        <div class="opt" data-value="Life Insurance">Life Insurance</div>
        <div class="opt" data-value="Critical Illness">Critical Illness</div>
        <div class="opt" data-value="Retirement/Long-Term Savings">Retirement/Long-Term Savings</div>
        <div class="opt" data-value="College Funding for Kids">College Funding for Kids</div>
      </div>
    </div>

    <div class="card">
      <h3>4) Current cover</h3>
      <div class="row grid-2" data-group="cover">
        <div class="opt" data-value="HMO only">HMO only</div>
        <div class="opt" data-value="HMO + Insurance">HMO + Insurance</div>
        <div class="opt" data-value="Insurance only">Insurance only</div>
        <div class="opt" data-value="None / Not sure">None / Not sure</div>
      </div>
    </div>

    <div class="card">
      <h3>5) Comfortable budget</h3>
        <div class="row grid-2" data-group="budget">
          <div class="opt" data-value="₱20–₱50/day">₱20–₱50/day</div>
          <div class="opt" data-value="₱50–₱100/day">₱50–₱100/day</div>
          <div class="opt" data-value="₱100+/day">₱100+/day</div>
          <div class="opt" data-value="Not Sure">Not Sure</div>
        </div>
      <div class="small">Tip: 30 days ≈ monthly. Example: ₱20/day ≈ ₱600/month.</div>
    </div>

    <!-- NEW Q6 -->
    <div class="card">
      <h3>6) What age is closest to yours?</h3>
      <div class="row grid-2" data-group="age">
        <div class="opt" data-value="20 years old">20 years old</div>
        <div class="opt" data-value="30 years old">30 years old</div>
        <div class="opt" data-value="40 years old">40 years old</div>
        <div class="opt" data-value="50 years old">50 years old</div>
      </div>
    </div>

    <div class="card">
      <h3>7) Book a 15-min checkup</h3>
      <div class="row grid-3" data-group="slot">
        <div class="opt" data-value="Before I leave / Lunch">Before I leave / Lunch</div>
        <div class="opt" data-value="Later today / After shift">Later today / After shift</div>
        <div class="opt" data-value="Tonight (Zoom)">Tonight (Zoom)</div>
      </div>
    </div>

    <div class="card">
      <h3>8) Where should we send your Quick Result?</h3>
      <div class="row">
        <div id="consentQuick" class="opt" data-variant="green" data-toggle="true">
          Yes, send me my Quick Result and option/s.
        </div>
      </div>
      <div class="row grid-2 mt12" data-group="channels" data-multi="true">
        <div class="opt small" data-value="SMS">SMS</div>
        <div class="opt small" data-value="Viber">Viber</div>
      </div>
    </div>

    <div class="card">
      <h3>9) Consent</h3>
      <div class="row">
        <div id="consentBook" class="opt" data-variant="green" data-toggle="true" data-selected="true">
          Contact me about my 15-min checkup
        </div>
        <div id="consentPromo" class="opt" data-toggle="true">Optional: Join our Financial Wellness Newsletter</div>
      </div>
    </div>

    <div class="card">
      <h3>Advisor notes (optional)</h3>
      <textarea id="notes" class="input" placeholder="Any context or special requests…"></textarea>
    </div>

    <div class="actions no-print">
      <button id="btnClear" class="button ghost">Clear</button>
      <button id="btnSubmit" class="button primary">Submit</button>
    </div>
    <div class="small no-print" id="validation"></div>
  </section>

  <!-- RESULT VIEW -->
  <section id="tab-result" class="hide">
    <div class="card" id="resultView">
      <h2>Quick Result</h2>
      <div class="small" id="resultMeta"></div>
      <div class="hr"></div>

      <div class="kv"><div class="small">Client</div><div id="r-client"></div></div>
      <div class="kv"><div class="small">Role</div><div id="r-role"></div></div>
      <div class="kv"><div class="small">Breadwinner</div><div id="r-bw"></div></div>
      <div class="kv"><div class="small">Priority</div><div id="r-prio"></div></div>
      <div class="kv"><div class="small">Current Cover</div><div id="r-cover"></div></div>
      <div class="kv"><div class="small">Budget Guide</div><div id="r-budget"></div></div>
      <div class="kv"><div class="small">Age</div><div id="r-age"></div></div>
      <div class="kv"><div class="small">Next Step</div><div id="r-slot"></div></div>
      <div class="kv"><div class="small">Send via</div><div id="r-send"></div></div>
      <div class="kv"><div class="small">Advisor Notes</div><div id="r-notes"></div></div>

      <div class="hr"></div>
      <div style="font-weight:700">Suggested Direction</div>
      <div id="r-suggestion" style="margin-top:6px"></div>
      <div class="hr"></div>
<div style="font-weight:700">For more information, contact your financial advisor:</div>
<div id="r-contact" style="margin-top:6px; white-space:pre-line"></div>
    </div>

    <div class="actions no-print mt12">
      <button id="btnPrint" class="button ghost">Print Result (PDF)</button>
      <button id="btnShare" class="button ghost">Share</button>
      <button id="btnNew" class="button warn">New Checkup</button>
    </div>

    <!-- PRINT-ONLY -->
    <div id="resultToPrint">
      <div>
        <div style="font-weight:800;font-size:18px">Quick Financial Wellness Check</div>
        <div class="small" id="printMeta"></div>
      </div>
      <hr style="margin:10px 0;border:0;border-top:1px solid #e5e7eb">
      <div id="printBody"></div>
    </div>
  </section>

  <!-- HISTORY -->
  <section id="tab-history" class="hide">
    <div class="card">
      <h3>History</h3>
      <div id="historyList" class="row"></div>
      <div class="small mt12">Stored locally on this device.</div>
    </div>
  </section>
</main>

<nav class="nav no-print">
  <div class="tab" id="nav-new">New Checkup</div>
  <div class="tab" id="nav-history">History</div>
  <div class="tab" id="nav-settings" data-active="true">Settings</div>
</nav>

<script>
const $=(s,d=document)=>d.querySelector(s);
const $$=(s,d=document)=>Array.from(d.querySelectorAll(s));
const fmtDateTime=d=>new Date(d).toLocaleString([], {year:'numeric',month:'short',day:'2-digit',hour:'2-digit',minute:'2-digit'});

const toMonthly = (label) => {
  if (label.includes('₱20') && label.includes('₱50')) return '≈ ₱600–₱1,500 / month';
  if (label.includes('₱50') && label.includes('₱100')) return '≈ ₱1,500–₱3,000 / month';
  if (label.includes('₱100')) return '≈ ₱3,000+ / month';
  return 'We’ll compute together based on your goals.';
};

const suggestByPriority = (p) => {
  switch (p) {
    case 'Retirement/Long-Term Savings':
      return `Future Protect is a variable unit-linked (VUL) plan that adapts to your life. Each premium you pay buys life insurance and invests the remainder into professionally managed funds aligned with your risk appetite—conservative, balanced or aggressive. You can increase payments when times are good or reduce them when budgets are tight, even taking a premium holiday if needed. An accident rider may be attached. Because your coverage and investment are intertwined, the plan evolves with you, helping you build wealth while ensuring your family’s financial safety net.

What makes this plan good for retirement planning is that you can choose the age of retirement (50, 55, 60, or 65) which will also become the maturity of the plan. By the time the plan matures, you can transfer it into a facility that will distribute the funds for 10 years.`;

    case 'College Funding for Kids':
    case 'Child Education': // backwards-compat for older saved records
      return `Future Scholar is a hybrid education plan created to ensure your child’s dreams don’t hinge on your health or finances. It has a portion that gives guaranteed returns, and a portion that is invested. You pay premiums for a limited period (5 years, or pay until the child is 17) and then, when your child reaches college age (18–21), the plan pays out guaranteed education benefits for four years. Should something happen to you, the plan continues—there is a payor’s benefit that waives remaining unpaid premiums, so your child still receives the full benefit. The investment portion allows the plan the opportunity to have better yield, which can be used to reinforce the guaranteed benefits, or as a graduation gift for the child. Parents choose Future Scholar because it offers certainty and peace of mind in an uncertain world where tuition fees keep rising.`;

    case 'Critical Illness':
      return `AIA Active Critical Protect 100 is a whole life critical illness plan that covers up to 100 major and minor illnesses, until age 100. It pays a lump sum upon diagnosis of early-detected or late-stage illnesses, so you can focus on recovery instead of finances. Integrated with AIA Vitality, it rewards healthy living with additional insurance coverage (+20% of face amount upon approval of the plan and can increase to a max of 50%). Optional riders include gender-specific cancer riders which give 50% of the face amount, and recovery benefit riders which give 10% of the face amount every year up to 5 years. Clients choose this plan to protect not just their life, but their lifestyle and independence when illness strikes.`;

    case 'Life Insurance':
      return `Guardian is an affordable term life plan designed to shield your loved ones from the financial shock of premature death and accidents. You have the option to choose a yearly renewable plan, or one that covers you until age 65. You can attach riders to provide additional coverage for accidents, critical illness, and daily hospital income. Guardian gives you the peace of mind that a single mishap won’t derail your family’s finances.`;

    default:
      return 'We’ll tailor a right-fit mix based on your answers.';
  }
};

let state={name:'',mobile:'',role:'',breadwinner:'',priority:'',cover:'',budget:'',age:'',slot:'',
           consentQuick:false,consentBook:true,consentPromo:false,channels:[],notes:''};
const STORAGE_KEY='qfs_surveys_v1';
const SETTINGS_KEY='qfs_settings_v1';

/* Tabs */
function setActiveTab(key){
  ['new','history','settings','result'].forEach(k=>{
    const sec=$(`#tab-${k}`); if(sec) sec.classList.toggle('hide',k!==key);
    const tab=$(`#nav-${k}`); if(tab) tab.dataset.active=(k===key);
  });
  if(key==='history') renderHistory();
}
let tabsLocked=true;
function lockTabs(lock){
  tabsLocked=lock;
  ['nav-new','nav-history'].forEach(id=>$('#'+id).classList.toggle('disabled',lock));
}
$('#nav-new').onclick=()=>{ if(!tabsLocked) setActiveTab('new'); };
$('#nav-history').onclick=()=>{ if(!tabsLocked) setActiveTab('history'); };
$('#nav-settings').onclick=()=> setActiveTab('settings');
$('#btnSettingsOpen').onclick=()=> setActiveTab('settings');

/* Settings */
function loadSettings(){
  const s=JSON.parse(localStorage.getItem(SETTINGS_KEY)||'{}');
  $('#s-advisor').value=s.advisor||'';
  $('#s-event').value=s.eventCode||'';
  $('#s-advisorPhone').value=s.advisorPhone||'';
}
function getSettings(){
  return {
    advisor: $('#s-advisor').value.trim(),
    eventCode: $('#s-event').value.trim(),
    advisorPhone: $('#s-advisorPhone').value.trim()
  };
}
function enforceSettingsGate(){
  const s=getSettings();
  const ok=!!(s.advisor && s.eventCode);
  lockTabs(!ok);
  if(!ok) setActiveTab('settings');
}
$('#btnSaveSettings').onclick=()=>{
  const s=getSettings();
  if(!s.advisor || !s.eventCode){
    $('#settingsWarn').textContent='Advisor name and Event Code are required.';
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(s));
    enforceSettingsGate();
    return;
  }
  $('#settingsWarn').textContent='Saved.';
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(s));
  enforceSettingsGate();
  if(!tabsLocked) setActiveTab('new');
};
loadSettings(); enforceSettingsGate();

/* Option groups */
function initOptionGroups(){
  ['role','breadwinner','priority','cover','budget','age','slot'].forEach(group=>{
    const box=document.querySelector(`[data-group="${group}"]`);
    box && box.addEventListener('click',e=>{
      const opt=e.target.closest('.opt'); if(!opt) return;
      $$('.opt',box).forEach(x=>x.dataset.selected="false");
      opt.dataset.selected="true"; state[group]=opt.dataset.value;
    });
  });
  const ch=document.querySelector('[data-group="channels"]');
  ch.addEventListener('click',e=>{
    const opt=e.target.closest('.opt'); if(!opt) return;
    const v=opt.dataset.value; const sel=opt.dataset.selected==="true";
    opt.dataset.selected=sel?"false":"true";
    state.channels = sel ? state.channels.filter(x=>x!==v) : [...new Set([...state.channels,v])];
  });
  // Toggles
  $('#consentQuick').addEventListener('click',e=>{
    const el=e.currentTarget; const on=el.dataset.selected==="true";
    el.dataset.selected=on?"false":"true"; state.consentQuick=!on;
  });
  $('#consentBook').addEventListener('click',e=>{
    const el=e.currentTarget; const on=el.dataset.selected==="true";
    el.dataset.selected=on?"false":"true"; state.consentBook=!on;
  });
  $('#consentPromo').addEventListener('click',e=>{
    const el=e.currentTarget; const on=el.dataset.selected==="true";
    el.dataset.selected=on?"false":"true"; state.consentPromo=!on;
  });
}
initOptionGroups();

/* Form */
function clearForm(){
  state={name:'',mobile:'',role:'',breadwinner:'',priority:'',cover:'',budget:'',age:'',slot:'',
         consentQuick:false,consentBook:true,consentPromo:false,channels:[],notes:''};
  $('#clientName').value=''; $('#clientMobile').value=''; $('#notes').value='';
  $$('[data-group]').forEach(g=>$$('.opt',g).forEach(o=>o.dataset.selected="false"));
  $('#consentBook').dataset.selected="true";
  $('#consentQuick').dataset.selected="false";
  $('#consentPromo').dataset.selected="false";
  $('#validation').textContent='';
}
$('#btnClear').onclick=clearForm;

function readFormBasics(){
  state.name=$('#clientName').value.trim();
  state.mobile=$('#clientMobile').value.trim();
  state.notes=$('#notes').value.trim();
}
function validate(){
  readFormBasics();
  const s=getSettings(); const errs=[];
  if(!s.advisor || !s.eventCode) errs.push('Complete Settings (Advisor name + Event Code). ');
  if(!state.name) errs.push('Please enter the client name. ');
  if(!state.priority) errs.push('Select a priority. ');
  if(state.consentQuick && !state.mobile) errs.push('Mobile is required if sending result. ');
  if(state.consentQuick && state.channels.length===0) errs.push('Pick at least one channel (SMS/Viber). ');
  if(!state.consentBook) errs.push('Please allow contact for the 15-min checkup.');
  $('#validation').textContent=errs.join('');
  return errs.length===0;
}

$('#btnSubmit').onclick=()=>{
  if(!validate()) return;
  const now=new Date(); const id='QFS-'+now.getTime();
  const record={...state,id,createdAt:now.toISOString(),settings:getSettings()};
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); all.unshift(record);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
  renderResult(record); setActiveTab('result');
};

/* History */
function renderHistory(){
  const wrap=$('#historyList'); wrap.innerHTML='';
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
  if(all.length===0){ wrap.innerHTML='<div class="small">No records yet.</div>'; return; }
  all.forEach(rec=>{
    const el=document.createElement('div');
    el.style.border='1.5px solid var(--line)'; el.style.borderRadius='14px';
    el.style.padding='12px 14px'; el.style.background='#fff';
    el.style.display='flex'; el.style.justifyContent='space-between'; el.style.alignItems='flex-start';
    el.innerHTML=`
      <div>
        <div><strong>${rec.name || '(No name)'}</strong> · <span class="small">${rec.priority||'-'}</span></div>
        <div class="small">${fmtDateTime(rec.createdAt)} · ${rec.budget||''}</div>
        <div class="small">${(rec.settings && rec.settings.eventCode) ? rec.settings.eventCode : ''}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="button ghost" data-id="${rec.id}" data-action="view">View</button>
        <button class="button warn" data-id="${rec.id}" data-action="delete">Delete</button>
      </div>
    `;
    el.querySelector('[data-action="view"]').onclick=()=>{ renderResult(rec); setActiveTab('result'); };
    el.querySelector('[data-action="delete"]').onclick=()=>{ if(confirm('Delete this entry?')){ deleteRecord(rec.id); renderHistory(); } };
    wrap.appendChild(el);
  });
}
function deleteRecord(id){
  const all=(JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')).filter(r=>r.id!==id);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(all));
}

/* Result & Print */
function renderResult(rec){
  const s = rec.settings || {};

  // existing fields …
  $('#resultMeta').textContent = `${fmtDateTime(rec.createdAt)}${s.eventCode ? ' • ' + s.eventCode : ''}`;
  $('#r-client').textContent = `${rec.name}${rec.mobile ? ' • ' + rec.mobile : ''}`;
  $('#r-role').textContent = rec.role || '-';
  $('#r-bw').textContent = rec.breadwinner || '-';
  $('#r-prio').textContent = rec.priority || '-';
  $('#r-cover').textContent = rec.cover || '-';
  $('#r-budget').textContent = (rec.budget || '-') + '  ·  ' + toMonthly(rec.budget || '');
  $('#r-age').textContent = rec.age || '-';
  $('#r-slot').textContent = rec.slot || '-';
  $('#r-send').textContent = rec.consentQuick ? (rec.channels.join(', ') || '-') : '— not requested';
  $('#r-notes').textContent = rec.notes || '—';
  $('#r-suggestion').textContent = suggestByPriority(rec.priority || '');

  // ----- Contact (screen) -----
  const contactLines = [];
  if (s.advisor) contactLines.push(`${s.advisor}`);
  contactLines.push('Financial Advisor');
  if (s.advisorPhone) contactLines.push(s.advisorPhone);
  contactLines.push(
    '8/F AIA Salcedo Bldg.,\n' +
    '126 L.P. Leviste St.,\n' +
    'Salcedo Village, Makati City'
  );
  $('#r-contact').textContent = contactLines.join('\n');

  // ----- PRINT payload (single section) -----
  $('#printMeta').textContent = `${fmtDateTime(rec.createdAt)}${s.eventCode ? ' • ' + s.eventCode : ''}`;
  const bodyParts = [
    `<div style="margin:6px 0"><strong>Client:</strong> ${rec.name}${rec.mobile ? ' · ' + rec.mobile : ''}</div>`,
    `<div style="margin:6px 0"><strong>Role:</strong> ${rec.role || '-'} · <strong>Breadwinner:</strong> ${rec.breadwinner || '-'}</div>`,
    `<div style="margin:6px 0"><strong>Priority:</strong> ${rec.priority || '-'}</div>`,
    `<div style="margin:6px 0"><strong>Current Cover:</strong> ${rec.cover || '-'}</div>`,
    `<div style="margin:6px 0"><strong>Budget Guide:</strong> ${rec.budget || '-'} (${toMonthly(rec.budget || '')})</div>`,
    `<div style="margin:6px 0"><strong>Age:</strong> ${rec.age || '-'}</div>`,
    `<div style="margin:6px 0"><strong>Next Step:</strong> ${rec.slot || '-'}</div>`,
    `<div style="margin:6px 0"><strong>Send via:</strong> ${rec.consentQuick ? (rec.channels.join(', ') || '-') : 'not requested'}</div>`,
    `<div style="margin:6px 0"><strong>Advisor Notes:</strong> ${rec.notes || '—'}</div>`,
    `<hr style="border:0;border-top:1px solid #e5e7eb;margin:12px 0">`,
    `<div><strong>Suggested Direction:</strong> ${suggestByPriority(rec.priority || '')}</div>`
  ];

  // contact block for print
  const contactHTML = `
    <div style="margin-top:16px">
      <div style="font-weight:700">For more information, contact your financial advisor:</div>
      <div style="margin-top:6px; white-space:pre-line">
${s.advisor || ''}${s.advisor ? '\n' : ''}Financial Advisor
${s.advisorPhone ? s.advisorPhone + '\n' : ''}
8/F AIA Salcedo Bldg.,
126 L.P. Leviste St.,
Salcedo Village, Makati City
      </div>
    </div>`;

  $('#printBody').innerHTML = bodyParts.join('') + contactHTML;
}

$('#btnPrint').onclick=()=>window.print();
$('#btnNew').onclick=()=>{ clearForm(); setActiveTab('new'); };
$('#btnShare').onclick=async()=>{
  const all=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); if(!all.length)return;
  const s=all[0];
  const text=`Quick Result for ${s.name} (${fmtDateTime(s.createdAt)}): ${s.priority}. Budget ${s.budget}. Next step: ${s.slot}.`;
  try{ if(navigator.share) await navigator.share({title:'Quick Result',text}); else { await navigator.clipboard.writeText(text); alert('Copied to clipboard.'); } }catch(e){}
};

/* Boot */
document.addEventListener('DOMContentLoaded',()=>{ setActiveTab('settings'); enforceSettingsGate(); });
</script>
</body>
</html>
